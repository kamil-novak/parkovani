import{dx as B,dw as v,dy as T,dz as O,dA as G,dB as H,s as U,dC as E,dD as V,dE as D,dF as F,dG as W,dH as L}from"./index-CDF62Mj_.js";import{c as I}from"./fontUtils-C8MTGdeM.js";const R="picture-fill",J="picture-marker",K="simple-fill",N="simple-line",Q="simple-marker",X="text",Y="Aa",_=B.size,C=B.maxSize,$=B.maxOutlineSize,A=B.lineWidth,Z=225,ee=document.createElement("canvas");function q(a,e){const l=ee.getContext("2d"),n=[];e&&(e.weight&&n.push(e.weight),e.size&&n.push(e.size+"px"),e.family&&n.push(e.family)),l.font=n.join(" ");const{width:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:m,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u}=l.measureText(a);return{width:Math.ceil(Math.max(c,h+m)),height:Math.ceil(s+u),x:Math.floor(h),y:Math.floor((s-u)/2)}}function x(a){const e=a==null?void 0:a.size;return{width:e!=null&&typeof e=="object"&&"width"in e?v(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?v(e.height):null}}async function ae(a,e){const l=e.fill,n=a.color;if((l==null?void 0:l.type)==="pattern"&&n&&a.type!==R){const c=await W(l.src,n.toCss(!0));l.src=c,e.fill=l}}async function ne(a,e,l,n){var m,s,u;if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await I(a.font)}catch{}const{width:c,height:h}=x(n);if(!/[\uE600-\uE6FF]/.test(e.shape.text)){const{width:p,height:f,x:i,y:o}=q(e.shape.text,{weight:(m=e.font)==null?void 0:m.weight,size:(s=e.font)==null?void 0:s.size,family:(u=e.font)==null?void 0:u.family});l[0]=c??p,l[1]=h??f,e.shape.x=i,e.shape.y=o;let w="angle"in a?a.angle:null;if((n==null?void 0:n.rotation)!=null&&(w=(w??0)+n.rotation),w){const M=w*(Math.PI/180),r=Math.abs(Math.sin(M)),d=Math.abs(Math.cos(M));l[1]=l[0]*r+l[1]*d}}}function le(a,e,l,n,c){var h;if(a.haloColor!=null&&a.haloSize!=null){c.masking??(c.masking=l.map(()=>[]));const m=v(a.haloSize);n[0]+=m,n[1]+=m,l.unshift([{...e,fill:null,stroke:{color:a.haloColor,width:2*m,join:"round",cap:"round"}}]),c.masking.unshift([{shape:{type:"rect",x:0,y:0,width:n[0]+2*L,height:n[1]+2*L},fill:[255,255,255],stroke:null},{...e,fill:[0,0,0,0],stroke:null}])}a.backgroundColor==null&&a.borderLineColor==null||(n[0]+=2*L,n[1]+=2*L,l.unshift([{shape:{type:"rect",x:0,y:0,width:n[0],height:n[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:v(a.borderLineSize)}}]),(h=c.masking)==null||h.unshift([]))}function P(a,e){return a>e?"dark":"light"}function ie(a,e){var M;const l=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,n=l!=null?v(l):null,c=(e==null?void 0:e.maxSize)!=null?v(e.maxSize):null;let h="angle"in a?a.angle:null;(e==null?void 0:e.rotation)!=null&&(h=(h??0)+e.rotation);const m=T(a);let s=O(a);oe(a,245)!=="dark"||e!=null&&e.ignoreWhiteSymbols||(s={width:.75,...s,color:"#bdc3c7"});const u={shape:null,fill:m,stroke:s,offset:[0,0]};s!=null&&s.width&&(s.width=Math.min(s.width,$));const p=(s==null?void 0:s.width)||0;let f=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),i=0,o=0,w=!1;switch(a.type){case Q:{const r=a.style,{width:d,height:t}=x(e),b=d===t&&d!=null?d:n??Math.min(v(a.size),c||C);switch(i=b,o=b,r){case"circle":u.shape={type:"circle",cx:0,cy:0,r:.5*b},f||(i+=p,o+=p);break;case"cross":u.shape={type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[i,.5*o]},{command:"M",values:[.5*i,0]},{command:"L",values:[.5*i,o]}]};break;case"diamond":u.shape={type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[.5*i,0]},{command:"L",values:[i,.5*o]},{command:"L",values:[.5*i,o]},{command:"Z",values:[]}]},f||(i+=p,o+=p);break;case"square":u.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,0]},{command:"L",values:[i,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]},f||(i+=p,o+=p),h&&(w=!0);break;case"triangle":u.shape={type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]},f||(i+=p,o+=p),h&&(w=!0);break;case"x":u.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,o]},{command:"M",values:[i,0]},{command:"L",values:[0,o]}]},h&&(w=!0);break;case"path":u.shape={type:"path",path:a.path||""},f||(i+=p,o+=p),h&&(w=!0),f=!0}break}case N:{const{width:r,height:d}=x(e),t=H(s).reduce((S,k)=>S+k,0),b=t&&Math.ceil(A/t),y=d??n??p,g=r??(t*b||A);s&&(s.width=y),i=g,o=y,f=!0,u.shape={type:"path",path:[{command:"M",values:[y/2,o/2]},{command:"L",values:[i-y/2,o/2]}]};break}case R:case K:{const r=typeof(e==null?void 0:e.symbolConfig)=="object"&&!!((M=e==null?void 0:e.symbolConfig)!=null&&M.isSquareFill),{width:d,height:t}=x(e);i=!r&&d!==t||d==null?n??_:d,o=!r&&d!==t||t==null?i:t,f||(i+=p,o+=p),f=!0,u.shape=r?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,0]},{command:"L",values:[i,o]},{command:"L",values:[0,o]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:G.fill[0];break}case J:{const r=Math.min(v(a.width),c||C),d=Math.min(v(a.height),c||C),{width:t,height:b}=x(e),y=t===b&&t!=null?t:n??Math.max(r,d),g=r/d;i=g<=1?Math.ceil(y*g):y,o=g<=1?y:Math.ceil(y/g),u.shape={type:"image",x:-Math.round(i/2),y:-Math.round(o/2),width:i,height:o,src:a.url||""},h&&(w=!0);break}case X:{const r=a,d=(e==null?void 0:e.overrideText)||r.text||Y,t=r.font,{width:b,height:y}=x(e),g=y??n??Math.min(v(t.size),c||C),{width:S,height:k}=q(d,{weight:t.weight,size:g,family:t.family}),z=/[\uE600-\uE6FF]/.test(d);i=b??(z?g:S),o=z?g:k;let j=.5*(z?g:k);z&&(j+=5),u.shape={type:"text",text:d,x:r.xoffset||0,y:r.yoffset||j,align:"middle",alignBaseline:r.verticalAlignment,decoration:t&&t.decoration,rotated:r.rotated,kerning:r.kerning},u.font=t&&{size:g,style:t.style,decoration:t.decoration,weight:t.weight,family:t.family};break}}return{shapeDescriptor:u,size:[i,o],renderOptions:{node:e==null?void 0:e.node,scale:f,opacity:e==null?void 0:e.opacity,rotations:[h],useRotationSize:w,effectView:e==null?void 0:e.effectView,ariaLabel:e==null?void 0:e.ariaLabel}}}async function he(a,e){var m;const{shapeDescriptor:l,size:n,renderOptions:c}=ie(a,e);if(!l.shape)throw new U("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ae(a,l),await ne(a,l,n,e);const h=[[l]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&((m=e==null?void 0:e.symbolConfig)!=null&&m.applyColorModulation)){const s=.6*n[0];h.unshift([{...l,offset:[-s,0],fill:E(l.fill,-.3)}]),h.push([{...l,offset:[s,0],fill:E(l.fill,.3)}]),n[0]+=2*s,c.scale=!1}return a.type==="text"&&le(a,l,h,n,c),V(h,n,c)}function oe(a,e=Z){const l=T(a),n=O(a),c=!l||"type"in l?null:new D(l),h=n!=null&&n.color?new D(n==null?void 0:n.color):null,m=c?P(F(c),e):null,s=h?P(F(h),e):null;return s?m?m===s?m:e>=Z?"light":"dark":s:m}export{oe as getContrastingBackgroundTheme,ie as getRenderSymbolParameters,he as previewSymbol2D};
